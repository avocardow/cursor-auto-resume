!function(){"use strict";console.log(`[${new Date().toLocaleTimeString()}] Cursor Smart Auto-Script (v1.0) Initializing...`);let e=["span.markdown-link[data-link='command:composer.resumeCurrentChat']","button[aria-label*='Continue']"],t=["button[aria-label*='Approve']","button[aria-label*='Run']"],n="div.bg-dropdown-background.border-dropdown-border",i=["Connection failed. If the problem persists","We're having trouble connecting to the model provider"],o="div.full-input-box",r=`${o} button:contains('Accept'), ${o} button:contains('Accept all')`,l=["accept","accept all"],a="div.bg-vscode-textSeparator-foreground",c=`${a} button:has(span.codicon-debug-step-back), ${a} button:contains('Skip')`,u=`${a} button:contains('Move to background')`,s=0,d="",p=null,f="",b=0;async function g(e){let t=document.querySelector("div.aislash-editor-input[contenteditable='true']");if(!t)return console.error("[AutoScript] Chat input field not found."),!1;t.focus(),document.execCommand("selectAll",!1,null),document.execCommand("insertText",!1,e),console.log(`[AutoScript] Typed "${e}" into chat input.`),await new Promise(e=>setTimeout(e,200));let n=document.querySelector("div.composer-button-area div.anysphere-icon-button:not([data-disabled='true']) span.codicon-arrow-up-two")||document.querySelector("div.composer-button-area div.anysphere-icon-button:not([data-disabled='true'])"),i=n?n.closest("div.anysphere-icon-button")||n:null;if(i&&"true"!==i.getAttribute("data-disabled"))return console.log("[AutoScript] Clicking send button."),i.click(),!0;console.warn("[AutoScript] Send button not found/disabled. Simulating Enter.");let o=new KeyboardEvent("keydown",{key:"Enter",code:"Enter",keyCode:13,which:13,bubbles:!0,cancelable:!0});return t.dispatchEvent(o),!0}function S(e,t=null,o=!0){let r=t||document;for(let l of e)try{let a=r.querySelectorAll(l);for(let c of a){let u=window.getComputedStyle(c);if("none"!==u.display&&"hidden"!==u.visibility&&!(c.disabled||"true"===c.getAttribute("aria-disabled"))&&null!==c.offsetParent){if(o){let s=c.closest(n);if(s){let d=s.textContent.toLowerCase();if(i.some(e=>d.includes(e.toLowerCase())))continue}}return console.log(`[AutoScript] Clicking element via selector "${l}":`,c.innerText||c.ariaLabel),c.click(),b=Date.now(),!0}}}catch(p){console.warn(`[AutoScript] Error with selector "${l}":`,p)}return!1}async function m(){let e=document.querySelectorAll(n);for(let t of e){let o=t.textContent.toLowerCase();if(i.some(e=>o.includes(e.toLowerCase()))){let r=window.getComputedStyle(t);if("none"!==r.display&&"hidden"!==r.visibility&&"0"!==r.opacity)return console.log(`[AutoScript] Problematic popup detected. Sending "continue". Text: ${t.textContent.substring(0,100)}`),await g("continue"),b=Date.now(),!0}}return!1}async function y(){let e=document.querySelectorAll("button, div[role='button']");for(let t of e){let n=t.textContent.trim().toLowerCase();if(l.includes(n)){let i=t.parentElement,o=0,r=!1;for(;i&&o<5;){let a=i.textContent;if(a.match(/\d+\s*file(s)?/i)&&a.match(/\+\d+/)&&a.match(/-\d+/)||i.querySelector("span[class*='codicon-git-']")||i.matches("div:has(> span[class*='codicon-git-'])")){r=!0;break}i=i.parentElement,o++}if(r){let c=window.getComputedStyle(t);if("none"!==c.display&&"hidden"!==c.visibility&&!t.disabled&&null!==t.offsetParent)return console.log(`[AutoScript] Found and clicking diff '${n}' button.`),t.click(),b=Date.now(),await new Promise(e=>setTimeout(e,2500)),console.log('[AutoScript] Sending "proceed" after accepting file changes.'),await g("proceed"),!0}}}return!1}async function $(e){if(e.toLowerCase().includes("requesting script to click terminal skip button")){let t=document.querySelectorAll(a);for(let n of t)if((n.querySelector(u)||n.querySelector(c.split(",")[0])||n.querySelector(c.split(",")[1].trim()))&&S([c.split(",")[0],c.split(",")[1].trim()],n,!1))return console.log("[AutoScript] Clicked terminal 'Skip' button as per AI request."),!0;console.warn("[AutoScript] AI requested terminal skip, but 'Skip' button not found/clickable in active terminal blocks.")}return!1}async function w(e){let t=document.querySelector(o);if(!t)return!1;let n=!1,i=document.createTreeWalker(t,NodeFilter.SHOW_TEXT),l;for(;l=i.nextNode();)if(l.nodeValue.includes("Generating...")){n=!0;break}let a=t.querySelector("button:contains('Stop'), button:has(span.codicon-stop-circle)");if(n&&a&&null!==a.offsetParent){if(null===p||e!==f)p=Date.now(),f=e;else if(Date.now()-p>75e3){console.warn("[AutoScript] 'Generating...' state appears stuck.");let c=t.querySelector(r.split(",")[0])||t.querySelector(r.split(",")[1].trim());return c&&null!==c.offsetParent&&!c.disabled?(console.log("[AutoScript] Clicking 'Accept' on stuck 'Generating...' bar (file changes)."),c.click(),b=Date.now(),await new Promise(e=>setTimeout(e,2500)),console.log("[AutoScript] Sending \"proceed\" after accepting changes from stuck 'Generating...' bar."),await g("proceed")):(console.log("[AutoScript] Sending \"proceed\" to try and unstick 'Generating...'."),await g("proceed"),b=Date.now()),p=null,f="",!0}}else p=null,f="";return!1}async function h(){if(Date.now()-b<1500)return;console.log("[AutoScript] Checking UI state...");let n=document.querySelectorAll("div.hide-if-empty[id^='bubble-'] > div.message-content-animated > span.anysphere-markdown-container-root"),i="";if(n.length>0&&(i=function e(t){if(!t)return"";let n="";return function e(t){if(t.nodeType===Node.TEXT_NODE)n+=t.nodeValue+" ";else if(t.nodeType===Node.ELEMENT_NODE&&"SCRIPT"!==t.nodeName&&"STYLE"!==t.nodeName)for(let i=0;i<t.childNodes.length;i++)e(t.childNodes[i])}(t),n.trim().replace(/\s+/g," ")}(n[n.length-1])),function e(t){if(!t)return!1;let n=t.toLowerCase();return n.includes("current phase: awaiting_human_input")||n.includes("awaiting human input")||n.includes("please advise")||n.includes("i am stuck")||n.includes("need your help")}(i)){console.warn(`[AutoScript] AI awaiting human input. Script pausing. Last AI msg: "${i.substring(0,100)}"`);return}if(await $(i)||await w(i)||await m()||await y()){s=0,d="";return}let o=function e(t){let n=0;for(let i=0;i<t.length;i++){let o=t.charCodeAt(i);n=(n<<5)-n+o,n|=0}return n}(document.body.innerText);if(S(e,null,!0)){d===o?s++:s=0,d=o,s>=3&&(console.warn(`[AutoScript] Clicked a 'Continue' type element ${s} times without DOM change. Pausing this action type briefly.`),s=0);return}if(S(t,null,!0)){s=0,d="";return}d!==o&&(s=0),d=o}setInterval(h,2500),console.log("[AutoScript] Main loop started. Checking every 2.5s."),h()}();
